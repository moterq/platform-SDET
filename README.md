# Platform-SDET Project

## Description

This project provides an automated testing framework for a FastAPI-based API with WebSocket support. The tests include checks for creating orders, validating their statuses through both REST API and WebSocket connections, and reporting using logs and Allure for local run.

## Features

- **API Testing**: Tests the creation and status tracking of orders via REST.
- **WebSocket Testing**: Ensures correct status sequences for orders.
- **Reporting**: Integration with custom logger and Allure for detailed test reports for local runs.
- **Docker Support**: Containerized app and tests using Docker.

---

## Project Structure

```bash
platform-SDET/
│
├── sdk/                      # SDK for interacting with the API
│   ├── base.py               # Base HTTP requester logic
│   ├── logger.py             # Custom logger implementation
│   ├── on_failure_printer.py # Utility for additional logging on failure
│   └── endpoints/            # Endpoints for API-related tests
│
├── tests/                   # Test suite
│   ├── api_tests/           # API-related tests (REST)
│   ├── performance_tests/   # Performance testing scripts (Async)
│   ├── unit_tests/          # Unit tests for components (Async + WebSocket)
│   └── conftest.py          # Global fixtures for testing
│
├── .env                     # Environment variables configuration
├── config.py                # Configuration loader for environment variables
├── Dockerfile               # Dockerfile to build the app
├── Dockerfile.test          # Dockerfile for running tests in Docker
├── docker-compose.yml       # Docker Compose file for application and services
├── docker-compose.test.yml   # Docker Compose for running tests
├── poetry.lock              # Poetry lock file
├── pyproject.toml           # Poetry project file (dependencies and config)
└── README.md                # Project documentation (this file)
```

## Installation & Setup

### Prerequisites
To run this project, ensure you have the following installed:

- Docker and Docker Compose
- Python 3.9+ (если запускать без Docker)
- Poetry (for dependency management)
- Allure (for generating and viewing test reports)

## Local Setup and Run 

1. Clone the Repository:
    ```bash
    git clone https://github.com/your-repo/platform-SDET.git
    cd platform-SDET
    ```
2. If you don't already have Poetry and allure installed, install it:
    ```bash
   curl -sSL https://install.python-poetry.org | python3 -
   poetry --version
   
   brew install allure
    ```

3. Install Dependencies:
    ```bash
    poetry install
    ```

4. If this is a local run in `.env`, comment out the following part of the code and comment out the rest of the code (for launching via Docker, don't change anything):
    ```bash
    BASE_URL=http://localhost:8000
    BASE_WEBSOCKET_URI=ws://localhost:8000/ws
    ```
   
5. Run the FastAPI Application Locally
   ```bash
   poetry run uvicorn main:app --host 0.0.0.0 --port 8000 --reload
   ```
   
6. Running tests locally:
    ```bash
    poetry run pytest -s ./tests --alluredir=reports/
    ```
7. Generate Allure report
    ```bash
    allure serve reports/
    ```
8. Access Swagger Documentation:
   ```bash
   http://127.0.0.1:8000/docs
   ```


## Running with Docker

1. Build and Start the Docker Containers:
    ```bash
    docker-compose up -d api
    ```

2. Run Tests in Docker:
    ```bash
    docker-compose up --build tests
    ```

3. Generate Allure Report in Docker:
    ```bash
    docker run --rm -it platform-sdet-tests allure serve reports/
    ```


## Environment Variables

For the application and tests to run correctly on a local machine (not in Docker), make sure the following environment variables are set in the .env file:
- `BASE_URL` - URL for accessing the API (e.g., `http://localhost:8000`).
- `BASE_WEBSOCKET_URI` - URI for WebSocket connection (e.g., `ws://localhost:8000/ws`).

P.S.> The default is BASE_URL to work in the Docker, you can replace the commented code with the present one and run locally

## Logs and Reports

- Logs of test execution and application activity are saved in the `logs/` directory.
- Test reports generated by Allure are stored in the `reports/` folder. Use the command `allure serve reports/` to view them on local machine (not in Docker).
